# 新功能说明

## 🎉 新增功能

### 1. 目录名完整显示
- ✅ 鼠标悬停时显示完整目录名（title 属性）
- ✅ 长目录名自动省略显示
- ✅ 更好的用户体验

### 2. 用户信息显示
- ✅ 右上角显示当前登录用户名
- ✅ 用户下拉菜单
  - 个人信息
  - 修改密码
  - 退出登录

### 3. 修改密码功能
- ✅ 独立的修改密码对话框
- ✅ 需要输入当前密码验证
- ✅ 新密码确认
- ✅ 密码强度验证（至少8个字符）
- ✅ 后端 API 支持

### 4. 中英文切换
- ✅ 右上角语言切换菜单
- ✅ 支持简体中文和英文
- ✅ 语言设置持久化（localStorage）
- ✅ 全局国际化支持
- ✅ Ant Design 组件国际化

## 📁 新增文件

### 前端文件

```
src/
├── components/
│   └── ChangePassword.js          # 修改密码组件
├── locales/
│   ├── index.js                   # 国际化主文件
│   ├── zh-CN.js                   # 中文语言包
│   └── en-US.js                   # 英文语言包
```

### 后端文件

- 无新增文件，仅修改现有文件

## 🔧 修改的文件

### 前端

1. **src/App.js**
   - 添加用户信息显示
   - 添加语言切换功能
   - 添加修改密码对话框
   - 集成国际化

2. **src/components/DirectoryTree.js**
   - 添加 title 属性显示完整目录名

### 后端

1. **app/Http/Controllers/Api/AuthController.php**
   - 添加 `changePassword` 方法

2. **routes/api.php**
   - 添加修改密码路由

## 🌍 国际化使用

### 在组件中使用

```javascript
import { t } from '../locales';

// 简单翻译
<Button>{t('common.save')}</Button>

// 带参数的翻译
import { formatMessage } from '../locales';
<span>{formatMessage('file.totalFiles', { count: 10 })}</span>
```

### 添加新的翻译

在 `src/locales/zh-CN.js` 和 `src/locales/en-US.js` 中添加：

```javascript
// zh-CN.js
export default {
  myModule: {
    myKey: '我的翻译',
  },
};

// en-US.js
export default {
  myModule: {
    myKey: 'My Translation',
  },
};
```

使用：
```javascript
t('myModule.myKey')
```

## 🎨 界面效果

### 右上角用户菜单

```
┌─────────────────────────────────────────┐
│ 提案系统    [🌐 简体中文 ▼] [👤 张三 ▼] │
└─────────────────────────────────────────┘
```

点击用户名下拉菜单：
```
┌──────────────┐
│ 👤 个人信息   │
│ 🔒 修改密码   │
│ ─────────── │
│ 🚪 退出登录   │
└──────────────┘
```

点击语言切换：
```
┌──────────────┐
│ 简体中文      │
│ English      │
└──────────────┘
```

### 修改密码对话框

```
┌─────────────────────────────┐
│ 修改密码              [X]   │
├─────────────────────────────┤
│ 当前密码：                  │
│ [🔒 ****************]       │
│                             │
│ 新密码：                    │
│ [🔒 ****************]       │
│                             │
│ 确认新密码：                │
│ [🔒 ****************]       │
│                             │
│         [取消]  [确定]      │
└─────────────────────────────┘
```

## 🔐 修改密码 API

### 请求

```http
PUT /api/change-password
Authorization: Bearer {token}
Content-Type: application/json

{
  "current_password": "old_password",
  "password": "new_password",
  "password_confirmation": "new_password"
}
```

### 响应

**成功：**
```json
{
  "message": "密码修改成功"
}
```

**失败（当前密码错误）：**
```json
{
  "message": "当前密码不正确"
}
```

**失败（验证错误）：**
```json
{
  "message": "The given data was invalid.",
  "errors": {
    "password": [
      "密码至少需要8个字符"
    ]
  }
}
```

## 📝 使用说明

### 修改密码

1. 点击右上角用户名
2. 选择"修改密码"
3. 输入当前密码
4. 输入新密码（至少8个字符）
5. 确认新密码
6. 点击"确定"

### 切换语言

1. 点击右上角语言图标
2. 选择"简体中文"或"English"
3. 界面立即切换语言

### 查看完整目录名

- 鼠标悬停在目录名上
- 会显示完整的目录名称

## 🔄 语言切换范围

已国际化的内容：
- ✅ 顶部导航栏
- ✅ 左侧菜单
- ✅ 用户菜单
- ✅ 目录管理
- ✅ 文件管理
- ✅ 提案管理
- ✅ 登录/注册页面
- ✅ 修改密码对话框
- ✅ Ant Design 组件（日期选择器、分页等）

## 🎯 待完善功能

### 短期
- [ ] 个人信息页面（查看和编辑）
- [ ] 头像上传
- [ ] 邮箱修改
- [ ] 更多语言支持（繁体中文、日语等）

### 中期
- [ ] 用户偏好设置
- [ ] 主题切换（深色模式）
- [ ] 快捷键支持
- [ ] 操作历史记录

## 🐛 注意事项

1. **语言切换**
   - 语言设置保存在 localStorage
   - 刷新页面后保持选择的语言

2. **修改密码**
   - 需要输入当前密码验证
   - 新密码至少8个字符
   - 修改成功后不会自动退出

3. **目录名显示**
   - 超长目录名会自动省略
   - 鼠标悬停查看完整名称
   - 不影响功能使用

## 📦 依赖更新

无需安装新的依赖包，所有功能使用现有依赖实现。

## 🚀 部署说明

### 前端

无需特殊配置，正常构建即可：
```bash
npm run build
```

### 后端

无需特殊配置，确保路由已更新：
```bash
php artisan route:clear
php artisan config:clear
```

## 🔍 故障排除

### 问题1：语言切换不生效

**解决方案：**
- 清除浏览器缓存
- 检查 localStorage 中的 locale 值
- 刷新页面

### 问题2：修改密码失败

**解决方案：**
- 检查当前密码是否正确
- 确认新密码至少8个字符
- 查看后端日志

### 问题3：用户名不显示

**解决方案：**
- 重新登录
- 检查 localStorage 中的 user 数据
- 确认 token 有效

## 📚 相关文档

- [API 文档](./API_DOCUMENTATION.md)
- [项目结构](./PROJECT_STRUCTURE.md)
- [快速开始](./QUICK_START.md)

## ✨ 更新日志

**v1.1.0** - 2025-10-14
- 新增：目录名完整显示（悬停提示）
- 新增：右上角用户信息显示
- 新增：修改密码功能
- 新增：中英文切换功能
- 新增：完整的国际化支持
- 优化：用户体验改进
